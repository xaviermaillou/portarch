{"ast":null,"code":"var _jsxFileName = \"/Users/xavier/Documents/De\\u0301veloppement/portarch/src/components/ajouter.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport firebase from '../firebase';\nimport Projet from './projet';\n\nconst Ajouter = ({\n  setRefresh,\n  mesœuvres\n}) => {\n  var _firebase$auth$curren, _firebase$auth$curren2, _firebase$auth$curren3, _firebase$auth$curren4, _firebase$auth$curren5;\n\n  const [œuvre, setœuvre] = useState({\n    auteurID: (_firebase$auth$curren = firebase.auth().currentUser) === null || _firebase$auth$curren === void 0 ? void 0 : _firebase$auth$curren.uid,\n    auteur: (_firebase$auth$curren2 = firebase.auth().currentUser) === null || _firebase$auth$curren2 === void 0 ? void 0 : (_firebase$auth$curren3 = _firebase$auth$curren2.displayName) === null || _firebase$auth$curren3 === void 0 ? void 0 : _firebase$auth$curren3.toLowerCase(),\n    note: 0,\n    photoAuteur: ((_firebase$auth$curren4 = firebase.auth().currentUser) === null || _firebase$auth$curren4 === void 0 ? void 0 : _firebase$auth$curren4.photoURL) ? (_firebase$auth$curren5 = firebase.auth().currentUser) === null || _firebase$auth$curren5 === void 0 ? void 0 : _firebase$auth$curren5.photoURL : 'https://firebasestorage.googleapis.com/v0/b/portarch-4f70e.appspot.com/o/icônes%2Fprofil2.png?alt=media&token=8342524c-b192-45be-83c3-86a0fb11bf37',\n    titre: '',\n    photo: ''\n  });\n  const [randomId, setRandomId] = useState(Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15));\n  const [percentage, setPercentage] = useState();\n  const [photoPrincipale, setPhotoPrincipale] = useState('https://firebasestorage.googleapis.com/v0/b/portarch-4f70e.appspot.com/o/œuvres-photos-principales%2Fgreece.png?alt=media&token=75893cf5-6875-4b7c-aca5-9ba03f71cb01');\n  const [agregado, setAgregado] = useState('');\n  const [width, setWidth] = useState(0);\n  useEffect(() => {\n    document.getElementsByClassName('lateral')[0].classList.add('ouvert');\n    setWidth(document.getElementsByClassName('lateral')[0].clientWidth);\n  }, []);\n  useEffect(() => {\n    if (mesœuvres.length < 1) {\n      setAgregado('AGREGAR');\n      document.getElementsByClassName('addForm')[0].classList.remove('ferme');\n    } else {\n      setTimeout(function () {\n        setAgregado('AGREGAR');\n        document.getElementsByClassName('addForm')[0].classList.remove('ferme');\n      }, 500);\n    }\n  }, [mesœuvres.length]);\n\n  const handleChangeTitle = e => {\n    const newœuvre = { ...œuvre\n    };\n    newœuvre.titre = e.target.value.toLowerCase();\n    setœuvre(newœuvre);\n  };\n\n  const handleEditPhoto = () => {\n    document.getElementsByName('photo')[0].click();\n  };\n\n  const handleEditPhotos = () => {\n    document.getElementsByName('photo2')[0].click();\n  };\n\n  const handleChangePhoto = e => {\n    if (e.target.files) {\n      var file = e.target.files[0];\n\n      if (file.type !== 'image/jpeg' && file.type !== 'image/png') {\n        return;\n      }\n\n      var ref = firebase.storage().ref('œuvres-photos-principales/' + file.name);\n      var task = ref.put(file);\n      task.on('state_changed', function (snapshot) {\n        var percentage = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n        setPercentage(percentage);\n\n        if (percentage === 100) {\n          setTimeout(function () {\n            ref.getDownloadURL().then(url => {\n              setPhotoPrincipale(url);\n              const newœuvre = { ...œuvre\n              };\n              newœuvre.photo = url;\n              setœuvre(newœuvre);\n            });\n          }, 1000);\n        }\n      });\n    } else {\n      return;\n    }\n  };\n\n  const handleChangePhotos = e => {\n    if (e.target.files) {\n      var files = Array.from(e.target.files);\n      console.log(files);\n      files.forEach(file => {\n        if (file.type !== 'image/jpeg' && file.type !== 'image/png') {\n          return;\n        }\n\n        var ref = firebase.storage().ref('œuvres-photos-secondaires/' + file.name);\n        ref.put(file).then(result => {\n          ref.getDownloadURL().then(url => {\n            firebase.firestore().collection('photos').add({\n              url: url,\n              œuvre: randomId\n            });\n          });\n        });\n      });\n      /* if(file.type !== 'image/jpeg' && file.type !== 'image/png') {\n          return;\n      }\n      var ref = firebase.storage().ref('œuvres-photos-principales/' + file.name);\n      var task = ref.put(file);\n      task.on('state_changed', function(snapshot) {\n          var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) *100;\n          setPercentage(percentage);\n           if(percentage === 100) {\n              setTimeout(function() {\n                  ref.getDownloadURL().then((url) => {\n                      setPhotoPrincipale(url);\n                      const newœuvre = {...œuvre};\n                      newœuvre.photo = url;\n                      setœuvre(newœuvre);\n                  });\n              }, 1000);\n          }\n      }); */\n    } else {\n      return;\n    }\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    firebase.firestore().collection('œuvres').doc(randomId).set(œuvre);\n    const form = document.getElementsByClassName('addForm')[0];\n    const mainPic = document.getElementsByClassName(\"mainPictureForm\")[0];\n    setTimeout(function () {\n      form.reset();\n      form.classList.add('ferme');\n      setPercentage(undefined);\n      mainPic.style.backgroundImage = 'none';\n      setAgregado('AGREGADO !');\n    }, 500);\n    setTimeout(function () {\n      setAgregado('AGREGAR');\n      form.classList.remove('ferme');\n      mainPic.style.backgroundImage = 'url(\"https://firebasestorage.googleapis.com/v0/b/portarch-4f70e.appspot.com/o/œuvres-photos-principales%2Fgreece.png?alt=media&token=75893cf5-6875-4b7c-aca5-9ba03f71cb01\")';\n    }, 3000);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"lateral ajouterContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }\n  }, \"MIS PROYECTOS\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\\u0153uvresContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }, mesœuvres.map(œuvre => /*#__PURE__*/React.createElement(Projet, {\n    setRefresh: setRefresh,\n    key: œuvre.id,\n    id: œuvre.id,\n    titre: œuvre.titre,\n    photo: œuvre.photo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 48\n    }\n  })), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 17\n    }\n  }), mesœuvres.length < 3 && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 25\n    }\n  }, agregado), /*#__PURE__*/React.createElement(\"form\", {\n    className: \"signupForm addForm ferme\",\n    onSubmit: e => handleSubmit(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 29\n    }\n  }, \"T\\xEDtulo\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    onChange: e => handleChangeTitle(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 29\n    }\n  }, \"Foto principal \", percentage && Math.round(percentage) + \"%\"), /*#__PURE__*/React.createElement(\"input\", {\n    style: {\n      display: 'none'\n    },\n    name: \"photo\",\n    type: \"file\",\n    onChange: e => {\n      handleChangePhoto(e);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mainPictureForm\",\n    style: {\n      backgroundImage: `url(${photoPrincipale})`,\n      height: width + 'px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"edit\",\n    onClick: handleEditPhoto,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 137\n    }\n  }, \"EDITAR\")), /*#__PURE__*/React.createElement(\"input\", {\n    style: {\n      display: 'none'\n    },\n    name: \"photo2\",\n    type: \"file\",\n    onChange: e => {\n      handleChangePhotos(e);\n    },\n    multiple: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"secondaryPicturesForm\",\n    style: {\n      height: width / 3.1 + 'px',\n      width: width / 3.1 + 'px'\n    },\n    onClick: handleEditPhotos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 29\n    }\n  })))));\n};\n\nexport default Ajouter;","map":{"version":3,"sources":["/Users/xavier/Documents/Développement/portarch/src/components/ajouter.tsx"],"names":["React","useState","useEffect","firebase","Projet","Ajouter","setRefresh","mesœuvres","œuvre","setœuvre","auteurID","auth","currentUser","uid","auteur","displayName","toLowerCase","note","photoAuteur","photoURL","titre","photo","randomId","setRandomId","Math","random","toString","substring","percentage","setPercentage","photoPrincipale","setPhotoPrincipale","agregado","setAgregado","width","setWidth","document","getElementsByClassName","classList","add","clientWidth","length","remove","setTimeout","handleChangeTitle","e","newœuvre","target","value","handleEditPhoto","getElementsByName","click","handleEditPhotos","handleChangePhoto","files","file","type","ref","storage","name","task","put","on","snapshot","bytesTransferred","totalBytes","getDownloadURL","then","url","handleChangePhotos","Array","from","console","log","forEach","result","firestore","collection","handleSubmit","preventDefault","doc","set","form","mainPic","reset","undefined","style","backgroundImage","map","id","round","display","height"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport firebase from '../firebase';\nimport Projet from './projet';\n\ntype Props = {\n    setRefresh: any,\n    mesœuvres: any\n}\n\nconst Ajouter: React.FC<Props> = ({ setRefresh, mesœuvres}) => {\n    const [œuvre, setœuvre] = useState({\n        auteurID: firebase.auth().currentUser?.uid,\n        auteur: firebase.auth().currentUser?.displayName?.toLowerCase(),\n        note: 0,\n        photoAuteur: firebase.auth().currentUser?.photoURL ? firebase.auth().currentUser?.photoURL : 'https://firebasestorage.googleapis.com/v0/b/portarch-4f70e.appspot.com/o/icônes%2Fprofil2.png?alt=media&token=8342524c-b192-45be-83c3-86a0fb11bf37',\n        titre: '',\n        photo: ''\n    });\n    const [randomId, setRandomId] = useState<string>(Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15));\n    const [percentage, setPercentage] = useState<number>();\n    const [photoPrincipale, setPhotoPrincipale] = useState<string>('https://firebasestorage.googleapis.com/v0/b/portarch-4f70e.appspot.com/o/œuvres-photos-principales%2Fgreece.png?alt=media&token=75893cf5-6875-4b7c-aca5-9ba03f71cb01');\n    const [agregado, setAgregado] = useState<string>('');\n    const [width, setWidth] = useState<number>(0);\n\n    useEffect(() => {\n        document.getElementsByClassName('lateral')[0].classList.add('ouvert');\n        setWidth(document.getElementsByClassName('lateral')[0].clientWidth);\n    }, []);\n\n    useEffect(() => {\n        if(mesœuvres.length < 1) {\n            setAgregado('AGREGAR'); \n            document.getElementsByClassName('addForm')[0].classList.remove('ferme');\n        }\n        else {\n            setTimeout(function(){ \n                setAgregado('AGREGAR');\n                document.getElementsByClassName('addForm')[0].classList.remove('ferme');\n            }, 500); \n        }      \n    }, [mesœuvres.length]);\n\n    const handleChangeTitle = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const newœuvre = {...œuvre};\n        newœuvre.titre = e.target.value.toLowerCase();\n        setœuvre(newœuvre);\n    }\n\n    const handleEditPhoto = () => {\n        document.getElementsByName('photo')[0].click()\n    }\n\n    const handleEditPhotos = () => {\n        document.getElementsByName('photo2')[0].click();\n    }\n\n    const handleChangePhoto = (e: React.ChangeEvent<HTMLInputElement>) => {        \n        if(e.target.files) {\n            var file = e.target.files[0];\n            if(file.type !== 'image/jpeg' && file.type !== 'image/png') {\n                return;\n            }\n            var ref = firebase.storage().ref('œuvres-photos-principales/' + file.name);\n            var task = ref.put(file);\n            task.on('state_changed', function(snapshot) {\n                var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) *100;\n                setPercentage(percentage);\n\n                if(percentage === 100) {\n                    setTimeout(function() {\n                        ref.getDownloadURL().then((url) => {\n                            setPhotoPrincipale(url);\n                            const newœuvre = {...œuvre};\n                            newœuvre.photo = url;\n                            setœuvre(newœuvre);\n                        });\n                    }, 1000);\n                }\n            });\n        } else {\n            return;\n        }\n    }\n\n    const handleChangePhotos = (e: React.ChangeEvent<HTMLInputElement>) => {        \n        if(e.target.files) {\n            var files = Array.from(e.target.files);\n            console.log(files);\n            files.forEach((file) => {\n                if(file.type !== 'image/jpeg' && file.type !== 'image/png') {\n                    return;\n                }\n                var ref = firebase.storage().ref('œuvres-photos-secondaires/' + file.name);\n                ref.put(file).then((result) => {\n                    ref.getDownloadURL().then((url) => {\n                        firebase.firestore().collection('photos').add({\n                            url: url,\n                            œuvre: randomId\n                        });\n                    });\n                });\n            });\n            /* if(file.type !== 'image/jpeg' && file.type !== 'image/png') {\n                return;\n            }\n            var ref = firebase.storage().ref('œuvres-photos-principales/' + file.name);\n            var task = ref.put(file);\n            task.on('state_changed', function(snapshot) {\n                var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) *100;\n                setPercentage(percentage);\n\n                if(percentage === 100) {\n                    setTimeout(function() {\n                        ref.getDownloadURL().then((url) => {\n                            setPhotoPrincipale(url);\n                            const newœuvre = {...œuvre};\n                            newœuvre.photo = url;\n                            setœuvre(newœuvre);\n                        });\n                    }, 1000);\n                }\n            }); */\n        } else {\n            return;\n        }\n    }\n\n    const handleSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        firebase.firestore().collection('œuvres').doc(randomId).set(œuvre);\n        const form = document.getElementsByClassName('addForm')[0] as HTMLFormElement;\n        const mainPic = document.getElementsByClassName(\"mainPictureForm\")[0] as HTMLElement;\n        setTimeout(function () {\n            form.reset();\n            form.classList.add('ferme');\n            setPercentage(undefined);\n            mainPic.style.backgroundImage = 'none';\n            setAgregado('AGREGADO !');\n        }, 500);\n        setTimeout(function () {\n            setAgregado('AGREGAR');\n            form.classList.remove('ferme');\n            mainPic.style.backgroundImage = 'url(\"https://firebasestorage.googleapis.com/v0/b/portarch-4f70e.appspot.com/o/œuvres-photos-principales%2Fgreece.png?alt=media&token=75893cf5-6875-4b7c-aca5-9ba03f71cb01\")';\n        }, 3000);\n    }\n\n    return (\n        <div className=\"lateral ajouterContainer\">\n            <h2>MIS PROYECTOS</h2>\n            <div className=\"œuvresContainer\">\n                {mesœuvres.map((œuvre: any) => <Projet \n                                                    setRefresh={setRefresh}\n                                                    key={œuvre.id} \n                                                    id={œuvre.id} \n                                                    titre={œuvre.titre} \n                                                    photo={œuvre.photo}\n                                                />)}\n                <br />\n                {mesœuvres.length < 3 &&\n                    <div>\n                        <h3>{agregado}</h3>\n                        <form className=\"signupForm addForm ferme\" onSubmit={(e) => handleSubmit(e)} >\n                            <label>Título</label>\n                            <input type=\"text\" onChange={(e) => handleChangeTitle(e)} />\n                            <label>Foto principal {percentage && Math.round(percentage) + \"%\"}</label>\n                            <input style={{display: 'none'}} name=\"photo\" type=\"file\" onChange={(e) => {handleChangePhoto(e)}} />\n                            <div className=\"mainPictureForm\" style={{backgroundImage: `url(${photoPrincipale})`, height: width + 'px'}}><div className=\"edit\" onClick={handleEditPhoto}>EDITAR</div></div>\n                            <input style={{display: 'none'}} name=\"photo2\" type=\"file\" onChange={(e) => {handleChangePhotos(e)}} multiple />\n                            <div className=\"secondaryPicturesForm\" style={{height: width/3.1 + 'px', width: width/3.1 + 'px'}} onClick={handleEditPhotos}></div>\n                            <input type=\"submit\" />\n                        </form>\n                    </div>\n                }    \n            </div>\n        </div>\n    );\n}\n\nexport default Ajouter;"]},"metadata":{},"sourceType":"module"}